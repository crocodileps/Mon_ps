groups:
  - name: mon_ps_trading
    interval: 1m
    rules:
      # ========================================
      # OPPORTUNIT√âS (24h seulement)
      # ========================================
      
      - alert: NewOpportunitySpike
        expr: increase(monps_opportunities_detected_total[5m]) > 5
        labels:
          severity: info
        annotations:
          summary: "Pic d'opportunit√©s d√©tect√©"
          description: "{{ $value }} nouvelles opportunit√©s dans les 5 derni√®res minutes"

      # ========================================
      # ALERTES CRITIQUES SYST√àME
      # ========================================
      
      - alert: BackendDown
        expr: up{job="backend"} == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "üö® Backend API est DOWN"
          description: "L'API FastAPI ne r√©pond plus depuis 1 minute"

      - alert: BankrollCritique
        expr: monps_bankroll < 900
        for: 5m
        labels:
          severity: critical
          current_value: "{{ $value }}‚Ç¨"
          threshold: "900‚Ç¨"
        annotations:
          summary: "üí∏ Bankroll critique"
          description: "Bankroll actuel: {{ $value }}‚Ç¨ (seuil: 900‚Ç¨). STOP TRADING!"

      - alert: ROINegatif
        expr: monps_roi < 0
        for: 10m
        labels:
          severity: critical
          current_value: "{{ $value }}%"
        annotations:
          summary: "üìâ ROI n√©gatif"
          description: "ROI actuel: {{ $value }}%. Analyse des strat√©gies requise."

      - alert: WinRateFaible
        expr: monps_win_rate < 50
        for: 30m
        labels:
          severity: warning
          current_value: "{{ $value }}%"
        annotations:
          summary: "‚ö†Ô∏è Win rate faible"
          description: "Win rate: {{ $value }}% (seuil: 50%). R√©vision strat√©gie."

      # ========================================
      # ALERTES AGENTS ML
      # ========================================
      
      - alert: AgentPerformanceImproved
        expr: increase(agent_roi[1h]) > 5
        labels:
          severity: info
        annotations:
          summary: "üöÄ Agent ML am√©liore ses performances"
          description: "ROI agent augment√© de {{ $value }}% en 1h"

      - alert: AgentSignalStrong
        expr: agent_confidence > 85
        labels:
          severity: info
        annotations:
          summary: "üíé Signal ML haute confiance"
          description: "Agent d√©tecte opportunit√© avec {{ $value }}% confiance"

      # ========================================
      # ALERTES DONN√âES
      # ========================================
      
      - alert: NoDataCollection
        expr: time() - monps_last_collection_timestamp > 14400  # 4h
        labels:
          severity: warning
        annotations:
          summary: "‚ö†Ô∏è Pas de collecte depuis 4h"
          description: "Derni√®re collecte il y a {{ $value }}s. V√©rifier le collector."
