# Session 2025-12-12 #04 - Audit Ecosysteme Complet + Decision Refactorisation

## Contexte
Continuation de la session #03. Diagnostic complet des donnees et audit de l'ecosysteme Mon_PS pour comprendre pourquoi le DNA Narrative Generator n'utilise pas l'infrastructure existante.

## Realise

### 1. Verification Saison des Donnees
- Confirmation que les donnees sont pour la saison 2025-26 (CORRECTE)
- Leeds United, Burnley, Sunderland = promus pour 2025-26
- Leicester, Ipswich, Southampton = relegues apres 2024-25
- Les equipes dans le fichier sont correctes

### 2. Validation Man City Possession
- Donnees: 57.1%
- Realite 2025-26: 58.1%
- Delta: seulement 1% - ACCEPTABLE
- Le probleme initial etait une fausse alerte

### 3. Identification du Vrai Probleme
- `context.history.pressing_style = "LOW_BLOCK"` pour Man City
- Source: Understat classifie basé sur PPDA seul
- Probleme: PPDA eleve + possession elevee = POSSESSION, pas LOW_BLOCK
- Understat ne tient pas compte de la possession dans sa classification

### 4. Audit PPDA + Possession
- Test d'une formule de classification intelligente
- Resultat: 3/16 correct seulement (19%)
- Conclusion: Utiliser des scores continus (0-100) plutot que categories discretes

### 5. Inventaire des 726 Metriques
Decouverte de la richesse des donnees dans team_dna_unified_v2.json:
- 726 metriques numeriques disponibles
- Sections peu utilisees: context_dna (1 ref), exploit (0), betting (0), momentum_dna (0)
- Potentiel enorme non exploite

### 6. Audit Complet Ecosysteme
Infrastructure existante mais NON UTILISEE par DNA Narrative Generator:
- **UnifiedLoader**: API unifiee pour acceder aux donnees (FONCTIONNE)
- **QuantumBrain**: Orchestrateur avec 5 engines
- **Chess Engines**: matchup_engine, pattern_engine, coach_engine, referee_engine, variance_engine
- **35+ fichiers DNA**: timing_dna, shooter_profiles, goalkeeper_dna, defender_betting, etc.

### 7. Analyse Infrastructure pour Refactorisation
Verification que l'infrastructure existante fonctionne:
- `UnifiedLoader.get_team("Manchester City")` = OK
- `UnifiedLoader.get_all_teams()` = 96 equipes
- Timing DNA profiles = profils temporels par equipe
- Shooter profiles = 1482 tireurs
- Matchup Engine = calcule zones d'analyse

## Fichiers touches

### Crees cette session
- `/home/Mon_ps/docs/sessions/2025-12-12_04.md` - Cette session

### Lus/Analyses
- `/home/Mon_ps/data/quantum_v2/team_dna_unified_v2.json` - 96 equipes, 726 metriques
- `/home/Mon_ps/quantum/loaders/unified_loader.py` - API unifiee
- `/home/Mon_ps/quantum/chess_engine/core/quantum_brain.py` - Orchestrateur
- `/home/Mon_ps/quantum/chess_engine/engines/matchup_engine.py` - Engine matchup

## Problemes resolus

### 1. Fausse alerte donnees obsoletes
- **Probleme**: Pensait que les donnees etaient de 2022-23 (Leeds/Sunderland en EPL)
- **Solution**: Web search confirme promotions 2025-26

### 2. Man City possession
- **Probleme**: 57.1% semblait trop bas (attendu ~64%)
- **Solution**: Realite 2025-26 = 58.1%, delta acceptable de 1%

### 3. Classification PPDA incorrecte
- **Probleme**: Man City classe "LOW_BLOCK" par Understat
- **Solution Identifiee**: Ne pas utiliser pressing_style d'Understat, calculer depuis PPDA + possession

## En cours / A faire

### Decision en Attente
Quelle direction pour DNA Narrative Generator V2:

| Option | Description | Impact |
|--------|-------------|--------|
| **A** | Refactoriser generateur pour utiliser UnifiedLoader | Moyen |
| **B** | Creer wrapper orchestrant engines existants | Eleve |
| **C** | Fix minimal - pressing_style uniquement | Faible |

### Autres taches identifiees
- [ ] Corriger diesel_factor (StdDev = 6.1, trop faible)
- [ ] Ajuster normalisation PPDA pour equipes allemandes
- [ ] Ameliorer selection template identite

## Notes techniques

### Architecture Decouverte
```
AVANT (V1 - Actuel):
dna_narrative_generator.py
    └── json.load(team_dna_unified_v2.json) directement
    └── Calcule tout from scratch
    └── Ignore infrastructure existante

APRES (V2 - Propose):
dna_narrative_generator.py
    └── UnifiedLoader (API centralisee)
        └── team_dna_unified_v2.json
        └── timing_dna_profiles.json
        └── shooter_profiles.json
        └── goalkeeper_dna.json
    └── MatchupEngine (zones de friction)
    └── PatternEngine (patterns historiques)
```

### Chemins critiques
```python
# UnifiedLoader
from quantum.loaders.unified_loader import UnifiedLoader
loader = UnifiedLoader()
team = loader.get_team("Manchester City")  # Fonctionne

# QuantumBrain
from quantum.chess_engine.core.quantum_brain import QuantumBrain
brain = QuantumBrain()  # Orchestrateur complet

# Matchup Engine
from quantum.chess_engine.engines.matchup_engine import MatchupEngine
engine = MatchupEngine()
# Calcule: zone_box, zone_creation, zone_aerial, zone_wide, zone_transition
```

### Stats Ecosysteme
- 96 equipes dans team_dna_unified_v2.json
- 726 metriques numeriques disponibles
- 35+ fichiers DNA dans /data/
- 5 engines dans chess_engine/
- 1482 shooters dans shooter_profiles

## Commandes pour reprendre

```bash
# Verifier UnifiedLoader
python3 -c "
from quantum.loaders.unified_loader import UnifiedLoader
loader = UnifiedLoader()
print(f'Teams: {len(loader.get_all_teams())}')
print(loader.get_team('Liverpool').keys())
"

# Verifier DNA Narrative Generator
python3 quantum/profilers/dna_narrative_generator.py

# Verifier API
python3 api/routers/team_dna.py
```

## Conclusion Session
- Donnees validees comme correctes pour 2025-26
- Infrastructure riche decouverte mais non utilisee
- Decision de refactorisation en attente de validation Mya
- Le Mya Principle exige de ne pas agir sans accord explicite
