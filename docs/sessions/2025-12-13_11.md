# Session 2025-12-13 #11 - UnifiedBrain V2.0 - 34 Marches

## Contexte
Extension du UnifiedBrain de 4 marches a 34 marches avec:
- PoissonCalculator pour over/under Goals/Corners/Cards
- DerivedMarketsCalculator pour Double Chance et DNB
- LIQUIDITY_TAX et MIN_EDGE specifiques par marche

## Realise

### 1. Extension models.py (237L -> 507L)
- MarketType enum: 34 marches
- MARKET_CATEGORIES: 10 categories
- LIQUIDITY_TAX: taxe par marche (1-3%)
- MIN_EDGE_BY_MARKET: seuils par marche (2.5-6%)
- MatchPrediction: tous les champs pour 34 marches

### 2. Extension unified_brain.py (772L -> 1125L)
- PoissonCalculator class: PMF, CDF, over/under
- DerivedMarketsCalculator class: DC et DNB
- _build_all_probabilities(): 34 probabilites
- _calculate_edges(): avec LIQUIDITY_TAX par marche
- _find_best_by_category(): meilleur bet par categorie

### 3. 34 Marches Supportes
| Categorie | Marches |
|-----------|---------|
| 1X2 (3) | home_win, draw, away_win |
| Double Chance (3) | dc_1x, dc_x2, dc_12 |
| DNB (2) | dnb_home, dnb_away |
| BTTS (2) | btts_yes, btts_no |
| Goals Over (6) | 0.5, 1.5, 2.5, 3.5, 4.5, 5.5 |
| Goals Under (6) | 0.5, 1.5, 2.5, 3.5, 4.5, 5.5 |
| Corners Over (3) | 8.5, 9.5, 10.5 |
| Corners Under (3) | 8.5, 9.5, 10.5 |
| Cards Over (3) | 2.5, 3.5, 4.5 |
| Cards Under (3) | 2.5, 3.5, 4.5 |

### 4. Test Results
```
Liverpool vs Manchester City:
- Profiles: TRANSITION vs WIDE_ATTACK
- 1X2: 37.9% / 25.4% / 36.7%
- DC: 1X=63.3% | X2=62.1% | 12=74.6%
- DNB: Home=50.8% | Away=49.2%
- Expected Goals: 3.77
- Poisson O1.5=89.0% | O2.5=72.6% | O3.5=52.0%
- Best Bet: over_1.5 @ 1.30 (edge +9.6%, kelly 10%)
- Qualite: 80%
- 8/8 engines
- 34 marches
```

## Fichiers touches
- `quantum_core/brain/models.py` - modifie (237L -> 507L)
- `quantum_core/brain/unified_brain.py` - modifie (772L -> 1125L)
- `quantum_core/brain/models.py.bak` - cree (backup)
- `quantum_core/brain/unified_brain.py.bak` - cree (backup)

## Commits
```
432e37f feat(quantum_core): UnifiedBrain V2.0 - 34 Marches + Poisson + Derived Markets
```

## Architecture V2.0
```
┌─────────────────────────────────────────────────────────────────────────┐
│                    UnifiedBrain V2.0 (1125L)                           │
│                              │                                          │
│                     DataHubAdapter (651L)                               │
│                              │                                          │
│    ┌─────────────────────────┼─────────────────────────┐               │
│    │              8 ENGINES INTEGRES:                  │               │
│    │  matchup │ corner │ card │ coach │ referee       │               │
│    │  variance │ pattern │ chain                      │               │
│    └─────────────────────────┼─────────────────────────┘               │
│                              ▼                                          │
│              ┌───────────────┬───────────────┐                         │
│              │ PoissonCalc   │ DerivedCalc   │                         │
│              │ Goals/Corner  │ DC/DNB        │                         │
│              │ Cards O/U     │               │                         │
│              └───────────────┴───────────────┘                         │
│                              │                                          │
│                    BayesianFusion (348L)                               │
│                              │                                          │
│                    EdgeCalculator (141L)                               │
│                    + LIQUIDITY_TAX par marche                          │
│                    + MIN_EDGE par marche                               │
│                              │                                          │
│                    KellySizer (115L)                                   │
│                              ▼                                          │
│                    MatchPrediction                                     │
│                    (34 marches)                                        │
└─────────────────────────────────────────────────────────────────────────┘
```

## Usage

```python
from quantum_core.brain import get_unified_brain

brain = get_unified_brain()

# Analyse avec cotes
market_odds = {
    "1": 2.50, "X": 3.40, "2": 2.80,
    "dc_1x": 1.45, "dc_x2": 1.55, "dc_12": 1.35,
    "dnb_home": 1.85, "dnb_away": 2.10,
    "btts_yes": 1.75, "btts_no": 2.00,
    "over_15": 1.30, "over_25": 1.85, "over_35": 2.60,
    "corners_over_95": 1.90, "corners_over_105": 2.30,
    "cards_over_35": 1.80, "cards_over_45": 2.40,
}

prediction = brain.analyze_match(
    home="Liverpool",
    away="Manchester City",
    referee="Michael Oliver",
    market_odds=market_odds,
    bankroll=1000.0
)

# 34 probabilites disponibles
print(f"Over 2.5: {prediction.over_25_prob:.1%}")
print(f"DC 1X: {prediction.dc_1x_prob:.1%}")
print(f"DNB Home: {prediction.dnb_home_prob:.1%}")

# Best bets par categorie
for cat, rec in prediction.best_bets_by_category.items():
    print(f"{cat}: {rec.market.value} ({rec.edge.edge_after_liquidity:.1%})")
```

## Prochaines Etapes
- [ ] Creer API FastAPI
- [ ] Backtest sur donnees historiques
- [ ] Ajouter predicteur Scorers (buteurs)
- [ ] Ajouter predicteur Cards (cartons)

## Duree Session
~30 minutes
