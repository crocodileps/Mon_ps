# Session 2025-12-13 #15 - Audit Complet Understat + FBRef (Goalscorer Data)

## Contexte
Suite a l'implementation de UnifiedBrain V2.7 (93 marches), audit des donnees existantes pour preparer les marches First/Anytime Goalscorer.

## Realise

### 1. Audit Understat - Donnees Existantes
Decouverte que les donnees necessaires existent deja:

**all_shots_against_2025.json (11 MB):**
- 17,340 tirs totaux
- 1,869 buts avec minute exacte
- 649 matchs avec au moins 1 but
- 96 equipes (5 ligues)
- Cles: player, player_id, minute, result, xG, situation, shotType, match_id

**understat_raw_api.json (3 MB):**
- 5 ligues: EPL, La_liga, Bundesliga, Serie_A, Ligue_1
- EPL: 461 joueurs, 380 matchs (150 joues)
- Structure: teams, players, dates

**players_impact_dna.json:**
- 2,324 joueurs
- Donnees agregees: goals, xG, npxG, xGBuildup, xGChain

### 2. Audit FBRef - Mine d'Or

**fbref_players_complete_2025_26.json (17 MB):**
- 2,290 joueurs
- 8 tables par joueur: standard, shooting, passing, pass_types, gca, defense, possession, misc
- Donnees completes: Gls, xG, npxG, Sh, SoT, G/Sh, Minutes, GCA, SCA

**Top Buteurs 2025/26:**
1. Harry Kane (Bayern): 17 buts, 9.6 xG (+7.4)
2. Kylian Mbappe (Real Madrid): 16 buts, 13.8 xG (+2.2)
3. Erling Haaland (Man City): 15 buts, 14.4 xG (+0.6)

### 3. Conclusion Audit
**PAS BESOIN DE SCRAPING SUPPLEMENTAIRE!**

Donnees disponibles pour First/Anytime Goalscorer:
- Understat: minute exacte des buts -> is_first_goal, is_last_goal
- FBRef: xG, npxG, G/Sh, minutes -> goals_per_90, conversion_rate

## Fichiers touches

### Crees
- `scripts/scrapers/understat_goals_scraper.py` - Scraper (non utilise, donnees deja presentes)

### Analyses (non modifies)
- `data/goalkeeper_dna/all_shots_against_2025.json` - 11 MB, 1,869 buts
- `data/quantum_v2/understat_raw_api.json` - 3 MB, 5 ligues
- `data/quantum_v2/players_impact_dna.json` - 2,324 joueurs
- `data/fbref/fbref_players_complete_2025_26.json` - 17 MB, 2,290 joueurs

## En cours / A faire
- [ ] Transformer all_shots_against_2025.json en goalscorer_profiles_2025.json
- [ ] Calculer is_first_goal, is_last_goal par match
- [ ] Fusionner Understat (minute) + FBRef (xG, minutes)
- [ ] Creer GoalscorerCalculator pour UnifiedBrain

## Notes techniques

### Structure all_shots_against_2025.json
```json
{
  "Liverpool": [
    {
      "id": "637503",
      "minute": 5,
      "result": "Goal",  // ou "MissedShots", "SavedShot", etc.
      "xG": 0.316,
      "player": "Antoine Semenyo",
      "player_id": "8889",
      "situation": "OpenPlay",  // FromCorner, SetPiece, Penalty
      "shotType": "RightFoot",  // LeftFoot, Head
      "match_id": "28778",
      "league": "EPL"
    }
  ]
}
```

### Top First Goalscorers (calcules depuis donnees existantes)
```
Erling Haaland: 8 premiers buts
Kylian Mbappe: 7 premiers buts
Lautaro Martinez: 5 premiers buts
```

### Prochaine etape: Script de transformation
```python
# Pseudo-code
for team, shots in all_shots_against.items():
    goals = [s for s in shots if s['result'] == 'Goal']
    # Grouper par match, trier par minute
    # Marquer is_first_goal, is_last_goal
    # Agreger par joueur
```

## Statistiques Cles

| Source | Taille | Joueurs | Buts | Minute | xG |
|--------|--------|---------|------|--------|-----|
| Understat shots | 11 MB | - | 1,869 | OK | OK |
| Understat players | - | 2,324 | agrege | - | OK |
| FBRef | 17 MB | 2,290 | agrege | - | OK |
