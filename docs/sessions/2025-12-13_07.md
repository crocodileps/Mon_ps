# Session 2025-12-13 #07 - Creation Quantum Core MVP

## Contexte
Creation d'une architecture "Hedge Fund Grade" pour le systeme de prediction de paris sportifs.
Objectif: Implementer un moteur quantitatif professionnel avec Dixon-Coles, Remove Vig et Kelly Criterion.

## Realise

### 1. Architecture Quantum Core Complete
- Structure modulaire: data, probability, edge, markets, risk, utils
- 14 fichiers Python crees
- 2854 lignes de code total

### 2. Data Layer (data/manager.py)
- DataManager avec PostgresPool (2-20 connexions thread-safe)
- Fallback automatique vers JSON si PostgreSQL echoue
- TeamData, RefereeData, ScorerData, MatchContext dataclasses
- Friction Matrix 16 combinaisons tactiques
- Data Quality scoring pour ajuster la Confidence
- Normalisation des noms d'equipes

### 3. Probability Layer (probability/poisson.py)
- DixonColesModel avec rho = -0.13
- Double Poisson separe (lambda_home, lambda_away)
- ScoreMatrix 81 scores possibles (9x9)
- Tau adjustment pour scores faibles (0-0, 1-0, 0-1, 1-1)
- PoissonModel simple pour calculs independants

### 4. Edge Layer (edge/calculator.py)
- Remove Vig: Basic, Power (Buchdahl), Shin (1991)
- True Edge calculation vs proba DEVIGEE
- Kelly Criterion avec fraction configurable (0.25 par defaut)
- Expected Value calculation
- CLV (Closing Line Value) tracking
- Confidence-adjusted staking

### 5. Markets Layer (markets/base.py + goals.py)
- MarketPredictor classe abstraite (Template Method pattern)
- Confidence dynamique 7 facteurs (score 0-100)
- ConfidenceFactors: probability, data_quality, variance, model_agreement, sample_size, is_derby, key_player_missing
- Recommendation enum: AVOID -> SKIP -> LEAN -> BET -> STRONG_BET
- Prediction dataclass standardisee
- GoalsPredictor: Over/Under 0.5-4.5, BTTS, 1X2, Score Exact, Clean Sheet

### 6. Engine (engine.py)
- QuantumEngine orchestrateur principal
- predict() pour marche unique
- predict_match() pour tous les marches
- analyze_match() avec value bets et recommandations
- get_most_likely_scores()

### 7. Test MVP (test_mvp.py)
- Tests complets de tous les modules
- Validation integration end-to-end

### 8. Commit GitHub
```
8b57db0 feat(quantum_core): MVP Quant Grade - Dixon-Coles + Remove Vig + Kelly
Tag: quantum-core-mvp-v1.0
```

## Fichiers touches

### Crees
- `/home/Mon_ps/quantum_core/__init__.py`
- `/home/Mon_ps/quantum_core/engine.py` (233 lignes)
- `/home/Mon_ps/quantum_core/test_mvp.py` (149 lignes)
- `/home/Mon_ps/quantum_core/data/__init__.py`
- `/home/Mon_ps/quantum_core/data/manager.py` (819 lignes)
- `/home/Mon_ps/quantum_core/probability/__init__.py`
- `/home/Mon_ps/quantum_core/probability/poisson.py` (451 lignes)
- `/home/Mon_ps/quantum_core/edge/__init__.py`
- `/home/Mon_ps/quantum_core/edge/calculator.py` (459 lignes)
- `/home/Mon_ps/quantum_core/markets/__init__.py`
- `/home/Mon_ps/quantum_core/markets/base.py` (392 lignes)
- `/home/Mon_ps/quantum_core/markets/goals.py` (358 lignes)
- `/home/Mon_ps/quantum_core/risk/__init__.py`
- `/home/Mon_ps/quantum_core/utils/__init__.py`

## Problemes resolus

| Probleme | Solution |
|----------|----------|
| PostgreSQL team_stats manquante | Fallback automatique vers JSON |
| Confidence statique | 7 facteurs dynamiques avec scoring 0-100 |
| Edge vs proba brute | True Edge vs proba DEVIGEE (correction critique) |
| Double Poisson simpliste | Dixon-Coles avec tau adjustment |

## En cours / A faire

- [ ] Creer table `team_stats` dans PostgreSQL
- [ ] Ajouter predicteur Scorers (buteurs)
- [ ] Ajouter predicteur Cards (cartons)
- [ ] Creer API FastAPI pour exposer le systeme
- [ ] Backtest sur donnees historiques
- [ ] Nettoyer players_impact_dna.json

## Notes techniques

### Usage basique
```python
from quantum_core.engine import QuantumEngine

engine = QuantumEngine()
pred = engine.predict("Liverpool", "Man City", "over_25", odds=1.85)
```

### Donnees chargees au demarrage
- team_dna: 96 equipes
- narrative_dna: 96 equipes
- referee_dna: 61 arbitres
- scorer_profiles: 238 buteurs
- attacker_dna: 1199 joueurs

### References academiques
- Dixon & Coles (1997) - Modelling Association Football Scores
- Shin (1991, 1993) - Insider trading model for remove vig
- Buchdahl - Wisdom of the Crowd, Power method

### Formules cles
```
# Dixon-Coles tau adjustment
tau(0,0) = 1 - lambda_h * lambda_a * rho
tau(0,1) = 1 + lambda_h * rho
tau(1,0) = 1 + lambda_a * rho
tau(1,1) = 1 - rho

# Edge calculation
edge = (notre_proba - proba_devigee) / proba_devigee * 100

# Kelly Criterion
f* = (b*p - q) / b * fraction
```

## Duree Session
~45 minutes
