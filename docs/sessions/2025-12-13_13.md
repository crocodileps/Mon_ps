# Session 2025-12-13 #13 - UnifiedBrain V2.5 - Win to Nil (+4 Marches)

## Contexte
Extension de UnifiedBrain de 71 a 75 marches avec les marches Win to Nil (marches defensifs).

## Realise

### WinToNilCalculator (4 marches)
- **Fichier**: `quantum_core/brain/win_to_nil.py` (329 lignes)
- **Marches**:
  - Home Win to Nil YES - Home gagne, Away = 0 (scores: 1-0, 2-0, 3-0...)
  - Home Win to Nil NO - Home gagne, Away >= 1 (scores: 2-1, 3-1, 3-2...)
  - Away Win to Nil YES - Away gagne, Home = 0 (scores: 0-1, 0-2, 0-3...)
  - Away Win to Nil NO - Away gagne, Home >= 1 (scores: 1-2, 1-3, 2-3...)
- **Methode**: Distribution de Poisson (fallback car scores WTN rarement dans top 10)
- **LIQUIDITY_TAX**: 2.5%
- **MIN_EDGE**: 4%

### Integration UnifiedBrain V2.5
- Version mise a jour de 2.4 -> 2.5
- 75 marches totaux (etait 71)
- Integration complete du WinToNilCalculator
- Tests valides: sommes = probabilites Win exactes

## Fichiers touches
- `quantum_core/brain/win_to_nil.py` - CREE (329 lignes)
- `quantum_core/brain/models.py` - MODIFIE (+4 MarketTypes, +4 MatchPrediction fields, +LIQUIDITY_TAX, +MIN_EDGE)
- `quantum_core/brain/__init__.py` - MODIFIE (exports + version 2.5.0)
- `quantum_core/brain/unified_brain.py` - MODIFIE (integration calculateur, +75 markets)

## Problemes resolus
- **Home Win to Nil = 0%**: Le calculateur utilisait les correct_score_probs mais les scores WTN (1-0, 2-0) ne sont souvent pas dans le top 10
  - **Solution**: Utiliser Poisson par defaut car plus fiable pour ces scores specifiques

## En cours / A faire
- [x] WinToNilCalculator cree
- [x] Integration UnifiedBrain V2.5
- [x] Tests 75 marches valides
- [ ] Git commit pending

## Notes techniques

### Architecture UnifiedBrain V2.5
```
UnifiedBrain (13 composants):
1. DataHubAdapter -> Donnees unifiees
2. 8 Engines -> Analyses specialisees
3. PoissonCalculator -> Over/Under
4. DerivedMarketsCalculator -> DC, DNB
5. CorrectScoreCalculator -> 10 scores
6. HalfTimeCalculator -> 6 marches HT
7. AsianHandicapCalculator -> 8 AH lines
8. GoalRangeCalculator -> 4 tranches
9. DoubleResultCalculator -> 9 HT/FT
10. WinToNilCalculator -> 4 WTN (NEW)
11. BayesianFusion -> Fusion probas
12. EdgeCalculator -> Edges
13. KellySizer -> Sizing optimal
```

### 75 Marches Breakdown
| Categorie | Count | Details |
|-----------|-------|---------|
| 1X2 | 3 | home, draw, away |
| Double Chance | 3 | dc_1x, dc_x2, dc_12 |
| DNB | 2 | dnb_home, dnb_away |
| BTTS | 2 | yes, no |
| Goals Over | 6 | 0.5-5.5 |
| Goals Under | 6 | 0.5-5.5 |
| Corners | 6 | o/u 8.5, 9.5, 10.5 |
| Cards | 6 | o/u 2.5, 3.5, 4.5 |
| Correct Score | 10 | top 10 dynamiques |
| Half-Time | 6 | ht_1x2, ht_o/u, ht_btts |
| Asian Handicap | 8 | -0.5 a -2.0 (H&A) |
| Goal Range | 4 | 0-1, 2-3, 4-5, 6+ |
| Double Result | 9 | 9 combos HT/FT |
| Win to Nil | 4 | home/away WTN yes/no |
| **TOTAL** | **75** | |

### Test Results (Liverpool vs Man City)
```
1X2: 37.9% / 25.4% / 36.7%
xG: 3.77 (H: 1.81, A: 1.96)

Win to Nil:
  Home WTN YES: 11.7% (1-0, 2-0...)
  Home WTN NO:  26.2% (2-1, 3-1...)
  Away WTN YES: 14.1% (0-1, 0-2...)
  Away WTN NO:  22.6% (1-2, 1-3...)

Verifications:
  Home WTN Total: 37.9% = Home Win
  Away WTN Total: 36.7% = Away Win
```

### Commit Pending
```bash
git add quantum_core/brain/
git commit -m "feat(brain): WinToNil - +4 marches (75 total)"
git push origin main
```
