# Session 2025-12-13 #09 - DataHubAdapter Hedge Fund Grade

## Contexte
Connecter le DataOrchestrator aux 6+ engines existants via le pattern Adapter.
Approche: Meme interface, nouvelle implementation.

## Realise

### 1. Audit des Besoins des Engines
Analyse des 8 engines pour comprendre leur utilisation de data_hub:
- matchup_engine, coach_engine, variance_engine, chain_engine, pattern_engine: Recoivent matchup_data en parametre
- referee_engine: SEUL a appeler data_hub.get_referee_data()
- corner_engine, card_engine: Stateless, pas de data_hub

### 2. Audit Interface DataHub
Methodes requises identifiees:
- get_team_data(team_name)
- get_market_profile(team, location)
- get_corner_dna(team)
- get_card_dna(team)
- get_referee_data(referee)
- is_specialist(team, market, location)

### 3. Creation DataHubAdapter (651 lignes)
Adapter Pattern qui:
- Expose l'interface DataHub
- Utilise DataOrchestrator en interne
- Fournit structure `dna.corner` et `dna.card` pour CornerEngine/CardEngine
- Ajoute `style` et `cards_per90` pour RefereeEngine

### 4. Tests Integration
| Engine | Resultat |
|--------|----------|
| MatchupEngine | OK |
| CornerEngine | OK |
| CardEngine | OK |
| CoachEngine | OK |
| VarianceEngine | OK |
| PatternEngine | OK |
| RefereeEngine | Bug pre-existant (safe_get) |

**6/7 engines fonctionnent avec l'adapter**

## Fichiers Crees

### quantum_core/adapters/
- `__init__.py` - Exports
- `data_hub_adapter.py` (651L) - Adapter principal

## Commits
```
83dd0db feat(quantum_core): DataHubAdapter - Adapter Pattern pour engines
```

## Bug Identifie
RefereeEngine utilise `safe_get(ref_data, "cards_per90", 4.0)` incorrectement.
Le 4.0 est interprete comme une cle, pas comme default.
Fix: `safe_get(ref_data, "cards_per90", default=4.0)`

## Architecture Finale

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        DataHubAdapter (651L)                            │
│                    Meme interface que DataHub                           │
│                              │                                          │
│                              ▼                                          │
│                     DataOrchestrator (695L)                             │
│                              │                                          │
│              ┌───────────────┼───────────────┐                         │
│              ▼               ▼               ▼                          │
│  ┌───────────────┐  ┌───────────────┐  ┌───────────────┐               │
│  │ UnifiedLoader │  │  PostgreSQL   │  │Classification │               │
│  │   (96 teams)  │  │(quantum.*)    │  │    V25        │               │
│  └───────────────┘  └───────────────┘  └───────────────┘               │
└─────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                          6/7 ENGINES                                    │
│  MatchupEngine │ CoachEngine │ CornerEngine │ CardEngine               │
│  VarianceEngine │ PatternEngine │ (RefereeEngine - bug externe)        │
└─────────────────────────────────────────────────────────────────────────┘
```

## Usage

```python
from quantum_core.adapters import get_data_hub_adapter

adapter = get_data_hub_adapter()

# Prepare matchup pour les engines
matchup = adapter.prepare_matchup_data("Liverpool", "Manchester City", "Michael Oliver")

# Instancier et utiliser les engines
from quantum.chess_engine.engines.matchup_engine import MatchupEngine

engine = MatchupEngine(adapter)
result = engine.analyze("Liverpool", "Manchester City", matchup)
```

## Prochaines Etapes

- [ ] Fixer le bug safe_get dans RefereeEngine
- [ ] Creer UnifiedBrain qui utilise DataHubAdapter + tous les engines
- [ ] Ajouter BayesianFusion et EdgeCalculator
- [ ] API FastAPI pour exposer le systeme

## Duree Session
~30 minutes
