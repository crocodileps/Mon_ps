# Session 2025-12-13 #10 - UnifiedBrain Hedge Fund Grade

## Contexte
Creer le UnifiedBrain: Cerveau unifie integrant DataHubAdapter + 8 engines + probabilites + edges + Kelly sizing.

## Realise

### 1. Audit Composants Existants
- QuantumBrain V2.1 (238L) - analyse
- BayesianFusion V3.0 (348L) - reutilise
- EdgeCalculator (141L) - reutilise
- KellySizer (115L) - reutilise

### 2. Fix RefereeEngine
```
10f8a0e fix(referee_engine): Corriger safe_get avec default= keyword
```
- Bug: `safe_get(d, "key", default_value)` traitait default_value comme cle
- Fix: `safe_get(d, "key", default=value)` explicite
- Resultat: 7/7 engines fonctionnent

### 3. UnifiedBrain Implementation
Architecture Clean:
```
┌─────────────────────────────────────────────────────────────────────┐
│                    UnifiedBrain (1042L total)                      │
│                              │                                      │
│                     DataHubAdapter (651L)                          │
│                              │                                      │
│    ┌─────────────────────────┼─────────────────────────┐           │
│    │              8 ENGINES INTEGRES:                  │           │
│    │  matchup │ corner │ card │ coach │ referee       │           │
│    │  variance │ pattern │ chain                      │           │
│    └─────────────────────────┼─────────────────────────┘           │
│                              ▼                                      │
│                    BayesianFusion (348L)                           │
│                    (Fusion probabilites)                           │
│                              │                                      │
│                    EdgeCalculator (141L)                           │
│                    (Calcul edges + liquidity tax)                  │
│                              │                                      │
│                    KellySizer (115L)                               │
│                    (Stake optimal Kelly)                           │
│                              ▼                                      │
│                    MatchPrediction                                 │
│                    (Output final)                                  │
└─────────────────────────────────────────────────────────────────────┘
```

### 4. Test Results
```
Liverpool vs Manchester City:
- Profiles: TRANSITION vs WIDE_ATTACK
- 1X2: 37.9% / 25.4% / 36.7%
- Expected Goals: 3.77
- BTTS: 63.0%
- Quality: 80.0% (VERY_HIGH)

Best Bet Detecte:
- Over 2.5 @ 1.85
- Edge: +16.9%
- Kelly: 19.9% (cap 10%)
- Signal: STRONG_BET
```

## Fichiers Crees

### quantum_core/brain/
- `__init__.py` (33L) - Exports
- `models.py` (237L) - Dataclasses (MatchPrediction, MarketEdge, etc.)
- `unified_brain.py` (772L) - Cerveau principal

## Commits
```
10f8a0e fix(referee_engine): Corriger safe_get avec default= keyword
36e172f feat(quantum_core): UnifiedBrain - Cerveau Unifie Hedge Fund Grade
```

## Usage

```python
from quantum_core.brain import get_unified_brain

brain = get_unified_brain()

# Analyse sans cotes
prediction = brain.analyze_match(
    home="Liverpool",
    away="Manchester City",
    referee="Michael Oliver"
)

print(prediction.summary())

# Analyse avec cotes (Edge + Kelly)
market_odds = {
    "1": 2.50,
    "X": 3.40,
    "2": 2.80,
    "over_25": 1.85,
    "btts_yes": 1.75,
}

prediction = brain.analyze_match(
    home="Liverpool",
    away="Manchester City",
    referee="Michael Oliver",
    market_odds=market_odds,
    bankroll=1000.0
)

if prediction.best_bet:
    print(f"Best Bet: {prediction.best_bet.market.value}")
    print(f"Edge: {prediction.best_bet.edge.edge_after_liquidity:.1%}")
    print(f"Stake: {prediction.best_bet.stake_units:.2f} EUR")
```

## Prochaines Etapes

- [ ] Creer API FastAPI
- [ ] Backtest sur donnees historiques
- [ ] Ajouter predicteur Scorers (buteurs)
- [ ] Ajouter predicteur Cards (cartons)

## Duree Session
~45 minutes
