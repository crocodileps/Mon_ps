# Session 2025-12-12 #05 - Audit Exhaustif Complet + Architecture DNA Profiler V2

## Contexte
Continuation des sessions precedentes. Objectif: Audit COMPLET de l'ecosysteme Mon_PS pour finaliser l'architecture du DNA Profiler V2.

## Realise

### 1. Audit Exhaustif des Fichiers DNA
- 89 fichiers JSON = 170 MB de donnees
- `team_dna_unified_v2.json` identifie comme fichier le plus riche:
  - 96 equipes x 1,119 metriques = 107,424 data points
  - Sections: meta, context, tactical, exploit, fbref, defense, defensive_line, betting

### 2. Decouverte Critique: DNA Vectors = CODE MORT
- Les 10 DNA Vectors dans `dna_vectors.py` (1,106 lignes) sont:
  - NON importes nulle part dans le code
  - NON utilises
  - Schemas DIFFERENTS des donnees JSON reelles
- Les vectors definis: MarketDNA, ContextDNA, RiskDNA, TemporalDNA, NemesisDNA, PsycheDNA, SentimentDNA, RosterDNA, PhysicalDNA, LuckDNA
- CONCLUSION: Travailler directement avec les fichiers JSON

### 3. Verification Integration des Donnees
- `teams_context_dna.json` → INTEGRE dans `team_dna_unified_v2.json` (context.*)
- `timing_dna_profiles.json` → NON INTEGRE (decay_factor, avg_panic manquants)
- `gamestate_insights.json` → NON INTEGRE (closing_ability, comeback_vulnerability manquants)
- `corners_dna.json` → NON INTEGRE
- `cards_dna.json` → NON INTEGRE

### 4. Inventaire Infrastructure Code
- 127 fichiers Python = 55,172 lignes de code
- Chess Engine V2.x: 9 fichiers, 4,191 lignes
- Quantum Orchestrator: 14 fichiers, 10,173 lignes
- UnifiedLoader: 15 fichiers, 6,069 lignes (charge seulement 3 JSON)
- DNA Narrative Generator V1: 982 lignes (actuel)

### 5. UnifiedLoader - Bug Identifie
- `get_team()` retourne None si `get_all_teams()` n'a pas ete appele avant
- Workaround: Toujours appeler `get_all_teams()` d'abord pour trigger lazy loading

## Fichiers touches

### Lus/Analyses (non modifies)
- `/home/Mon_ps/quantum/models/dna_vectors.py` - 10 DNA Vectors (CODE MORT)
- `/home/Mon_ps/quantum/loaders/unified_loader.py` - 915 lignes
- `/home/Mon_ps/quantum/profilers/dna_narrative_generator.py` - 982 lignes (V1)
- `/home/Mon_ps/data/quantum_v2/team_dna_unified_v2.json` - 5.7 MB
- `/home/Mon_ps/data/quantum_v2/timing_dna_profiles.json` - 46 KB
- `/home/Mon_ps/data/quantum_v2/gamestate_insights.json` - 93 KB
- `/home/Mon_ps/data/football_data_uk/corners_dna_2025_26.json` - 29 KB
- `/home/Mon_ps/data/football_data_uk/cards_team_dna_2025_26.json` - 19 KB

### Crees cette session
- `/home/Mon_ps/docs/sessions/2025-12-12_05.md` - Cette session

## Problemes resolus

### 1. DNA Vectors inutilises
- **Probleme**: 10 classes DNA Vectors definies mais jamais utilisees
- **Solution**: Les ignorer completement, utiliser les JSON directement

### 2. Integration partielle des donnees
- **Probleme**: Certains fichiers satellites ont des donnees UNIQUES non integrees
- **Solution**: Charger les fichiers complementaires en plus de team_dna_unified_v2.json

### 3. Bug UnifiedLoader
- **Probleme**: `get_team()` retourne None sans appel prealable a `get_all_teams()`
- **Solution**: Workaround identifie, a corriger dans V2

## En cours / A faire

- [ ] **DECISION EN ATTENTE**: Validation architecture DNA Profiler V2
- [ ] Implementer DNA Profiler V2 avec enrichissement
- [ ] Corriger bug lazy loading UnifiedLoader
- [ ] Nettoyer code mort (dna_vectors.py)

## Notes techniques

### Architecture DNA Profiler V2 Proposee
```
BASE: team_dna_unified_v2.json (1,119 metriques/equipe)
├── tactical (possession, pressing, verticality)
├── defense (xga, timing_profile, percentiles)
├── context.history (ppda, pressing_style)
├── context.momentum_dna (form_last_5)
└── context.variance (luck_index)

ENRICHISSEMENT (fichiers complementaires):
├── timing_dna_profiles.json → diesel_factor, clutch_factor
│   (decay_factor, avg_panic, time_curve)
├── gamestate_insights.json → psyche axes
│   (closing_ability, comeback_vulnerability)
├── corners_dna_2025_26.json → set_piece metrics
└── cards_dna_2025_26.json → discipline metrics

OUTPUT: 18 axes (0-100) + marches exploitables
```

### Donnees Complementaires Identifiees
```python
# TIMING DNA (pas dans unified)
decay_factor: float  # 1.0 = neutre
time_curve: dict     # {0-30: 1.0, 30-45: 1.0, ...}
avg_panic: float     # Score de panique moyen
max_cvar: float      # CVaR maximum

# GAMESTATE INSIGHTS (pas dans unified)
closing_ability: str           # EXCELLENT, GOOD, POOR
comeback_vulnerability: int    # 0-5
collapses_when_leading: bool

# CORNERS/CARDS (pas dans unified)
corners_for_avg: float
over_105_rate: float
yellow_cards_avg: float
```

### Commandes pour reprendre
```bash
# Verifier UnifiedLoader
python3 -c "
from quantum.loaders.unified_loader import UnifiedLoader
loader = UnifiedLoader()
_ = loader.get_all_teams()  # Important: trigger lazy load
team = loader.get_team('Liverpool')
print(team.keys())
"

# Verifier DNA Narrative Generator actuel
python3 quantum/profilers/dna_narrative_generator.py

# Tester enrichissement
python3 -c "
import json
with open('data/quantum_v2/timing_dna_profiles.json') as f:
    timing = json.load(f)
print(timing['Liverpool'])
"
```

## Conclusion Session
- Audit exhaustif complete
- Architecture V2 finalisee
- En attente validation Mya pour implementation
- Le Mya Principle exige validation avant action
